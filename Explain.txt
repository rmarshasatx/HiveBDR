explain

with d1 as (select state_abbreviation,county_name, (cast( fpl  as double)) as `FPLp_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 73.53 ))*exp( - (pow( cast( fpl  as double) -  110.98 ,2))/(2e0*pow( 73.53 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 73.53 ))*exp( - (pow( cast( fpl  as double) -  110.98 ,2))/(2e0*pow( 73.53 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 89.4151036678835 ))*exp( - (pow( cast( fpl  as double) -  175.189305047549 ,2))/(2e0*pow( 89.4151036678835 ,2))  )))) as `FPLp`, (cast( Number_of_Persons_in_Living_Unit  as double)) as `HouseholdSize_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 1.89 ))*exp( - (pow( cast( Number_of_Persons_in_Living_Unit  as double) -  2.15 ,2))/(2e0*pow( 1.89 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 1.89 ))*exp( - (pow( cast( Number_of_Persons_in_Living_Unit  as double) -  2.15 ,2))/(2e0*pow( 1.89 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 1.22625865268413 ))*exp( - (pow( cast( Number_of_Persons_in_Living_Unit  as double) -  2.55099487929773 ,2))/(2e0*pow( 1.22625865268413 ,2))  )))) as `HouseholdSize`, (cast( person_1_gender='M'  as double)) as `Male_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.5 ))*exp( - (pow( cast( person_1_gender='M'  as double) -  0.44 ,2))/(2e0*pow( 0.5 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.5 ))*exp( - (pow( cast( person_1_gender='M'  as double) -  0.44 ,2))/(2e0*pow( 0.5 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.499734297015008 ))*exp( - (pow( cast( person_1_gender='M'  as double) -  0.473416239941478 ,2))/(2e0*pow( 0.499734297015008 ,2))  )))) as `Male`, (cast( coalesce(nullif(person_1_exact_age,''),person_1_estimated_age)  as double)) as `Age_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 15.16 ))*exp( - (pow( cast( coalesce(nullif(person_1_exact_age,''),person_1_estimated_age)  as double) -  43.81 ,2))/(2e0*pow( 15.16 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 15.16 ))*exp( - (pow( cast( coalesce(nullif(person_1_exact_age,''),person_1_estimated_age)  as double) -  43.81 ,2))/(2e0*pow( 15.16 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 19.4283269402032 ))*exp( - (pow( cast( coalesce(nullif(person_1_exact_age,''),person_1_estimated_age)  as double) -  50.7939941477688 ,2))/(2e0*pow( 19.4283269402032 ,2))  )))) as `Age`, (cast( person_1_ethnic_group='O'  as double)) as `HispanicLatino_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.47 ))*exp( - (pow( cast( person_1_ethnic_group='O'  as double) -  0.33 ,2))/(2e0*pow( 0.47 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.47 ))*exp( - (pow( cast( person_1_ethnic_group='O'  as double) -  0.33 ,2))/(2e0*pow( 0.47 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.368065909722137 ))*exp( - (pow( cast( person_1_ethnic_group='O'  as double) -  0.162918800292612 ,2))/(2e0*pow( 0.368065909722137 ,2))  )))) as `HispanicLatino`, (cast( person_1_ethnic_group='A'  as double)) as `AfricanAmerican_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.41 ))*exp( - (pow( cast( person_1_ethnic_group='A'  as double) -  0.21 ,2))/(2e0*pow( 0.41 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.41 ))*exp( - (pow( cast( person_1_ethnic_group='A'  as double) -  0.21 ,2))/(2e0*pow( 0.41 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.317921120055565 ))*exp( - (pow( cast( person_1_ethnic_group='A'  as double) -  0.126459400146306 ,2))/(2e0*pow( 0.317921120055565 ,2))  )))) as `AfricanAmerican`, (cast( Person_1_Occupation_group_v2 like '_9'  as double)) as `Retired_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.31 ))*exp( - (pow( cast( Person_1_Occupation_group_v2 like '_9'  as double) -  0.11 ,2))/(2e0*pow( 0.31 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.31 ))*exp( - (pow( cast( Person_1_Occupation_group_v2 like '_9'  as double) -  0.11 ,2))/(2e0*pow( 0.31 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.453087144442305 ))*exp( - (pow( cast( Person_1_Occupation_group_v2 like '_9'  as double) -  0.277081199707388 ,2))/(2e0*pow( 0.453087144442305 ,2))  )))) as `Retired`, (cast( Person_1_Marital_Status  LIKE '_S'  as double)) as `NeverMarried_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.46 ))*exp( - (pow( cast( Person_1_Marital_Status  LIKE '_S'  as double) -  0.31 ,2))/(2e0*pow( 0.46 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.46 ))*exp( - (pow( cast( Person_1_Marital_Status  LIKE '_S'  as double) -  0.31 ,2))/(2e0*pow( 0.46 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.459680602526681 ))*exp( - (pow( cast( Person_1_Marital_Status  LIKE '_S'  as double) -  0.276583760058522 ,2))/(2e0*pow( 0.459680602526681 ,2))  )))) as `NeverMarried`, (cast( sign(Number_of_Children_in_Living_Unit)  as double)) as `ChildreninHousehold_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.5 ))*exp( - (pow( cast( sign(Number_of_Children_in_Living_Unit)  as double) -  0.44 ,2))/(2e0*pow( 0.5 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.5 ))*exp( - (pow( cast( sign(Number_of_Children_in_Living_Unit)  as double) -  0.44 ,2))/(2e0*pow( 0.5 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.400959474690826 ))*exp( - (pow( cast( sign(Number_of_Children_in_Living_Unit)  as double) -  0.189378200438917 ,2))/(2e0*pow( 0.400959474690826 ,2))  )))) as `ChildreninHousehold`, (cast( Person_1_Education_Model LIKE '_1'  as double)) as `HighSchoolGraduate_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.49 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_1'  as double) -  0.42 ,2))/(2e0*pow( 0.49 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.49 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_1'  as double) -  0.42 ,2))/(2e0*pow( 0.49 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.490064900339291 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_1'  as double) -  0.436708119970739 ,2))/(2e0*pow( 0.490064900339291 ,2))  )))) as `HighSchoolGraduate`, (cast( Person_1_Education_Model LIKE '_2'  as double)) as `SomeCollege_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.4 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_2'  as double) -  0.2 ,2))/(2e0*pow( 0.4 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.4 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_2'  as double) -  0.2 ,2))/(2e0*pow( 0.4 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.400006210182272 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_2'  as double) -  0.183291880029261 ,2))/(2e0*pow( 0.400006210182272 ,2))  )))) as `SomeCollege`, (cast( Person_1_Education_Model LIKE '_3'  as double)) as `BachelorDegree_`, (( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.29 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_3'  as double) -  0.09 ,2))/(2e0*pow( 0.29 ,2))  ))/(( 0.401488616462347 *(1e0/(sqrt(2e0*pi())* 0.29 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_3'  as double) -  0.09 ,2))/(2e0*pow( 0.29 ,2))  ))+( 0.598511383537653 *(1e0/(sqrt(2e0*pi())* 0.395180996613422 ))*exp( - (pow( cast( Person_1_Education_Model LIKE '_3'  as double) -  0.190248719824433 ,2))/(2e0*pow( 0.395180996613422 ,2))  )))) as `BachelorDegree`, fpl,Number_of_Persons_in_Living_Unit as hhs,coalesce(nullif(person_1_exact_age,''),person_1_estimated_age) as yearsold,

greatest(

coalesce(if(fpl<low_threshold_in_state,percent_fi_less_than_or_equal_to_low_threshold,

if(fpl between low_threshold_in_state and high_threshold_in_state, percent_fi_between_thresholds,

percent_fi_grater_than_or_equal_to_high_threshold)),0),

coalesce(  if(number_of_children_in_living_unit>0 and fpl<=185,percent_food_insecure_children_in_hh_with_hh_incomes_below_185_fpl,

if(number_of_children_in_living_unit>0 and fpl>=185,percent_food_insecure_children_in_hh_with_hh_incomes_above_185_fpl ,0)),0))/100e0

as mgap,

food_insecurity_rate,child_food_insecurity_rate

from ( select round((case estimated_household_income_range_code_v6 when 'A' then 5

  when 'B' then 15 when 'C' then 25 when 'D' then 35 when 'E' then 50 when 'F' then 75 when 'G' then 100 when 'H' then 125 when 'I' then 150 when 'J' then 175 when 'K' then 200 when 'L' then 250 else cape_inc_hh_median_family_household_income/1000 end

  * 1000 )/(   case when state_abbreviation='AL' then 15950.00 + 5600*(number_of_persons_in_living_unit-1)

  when state_abbreviation='HI' then 14680.00 + 5150*(number_of_persons_in_living_unit-1)

  else 12760.00 + 4480*(number_of_persons_in_living_unit-1) end ) * 100) as fpl,* from lake_consumerview.consumerview_ind_layout

where state_abbreviation=? and county_name=?

) c

join dev_andrew_levitte.food_insecurity_map_gap m on cast(cast(c.state_code as integer)*1000+cast(c.county_code as integer) as string)=m.fips),

d2 as (select  1e0/(1e0+exp( (ln(1e0- fplp ) - ln( fplp ))+(ln(1e0- householdsize ) - ln( householdsize ))+(ln(1e0- male ) - ln( male ))+(ln(1e0- age ) - ln( age ))+(ln(1e0- hispaniclatino ) - ln( hispaniclatino ))+(ln(1e0- africanamerican ) - ln( africanamerican ))+(ln(1e0- nevermarried ) - ln( nevermarried ))+(ln(1e0- childreninhousehold ) - ln( childreninhousehold ))+(ln(1e0- mgap ) - ln( mgap )) ))  as fit,

* from d1)

select * from d2;